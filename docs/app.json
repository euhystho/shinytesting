[{"name":"app.R","content":"#library(CausalImpact)\n\n\n# These are the necessary packages for R Shiny:\nlibrary(shiny)\nlibrary(bslib)\nlibrary(shinyWidgets)\nlibrary(bsicons)\nlibrary(thematic)\n\nlibrary(ggplot2)\nlibrary(ggstatsplot)\nlibrary(patchwork)\n\n#STAHP COMPLAINING D:\n  options(warn=-1)\nui <- navbarPage(\n  \n#Puts Title on the Application on the top\n  title = \"Causal Impact Demo in R Shiny\",\n  \n  #Sets the theme for bslib using the Bootswatch Library:\n  theme = bs_theme(\n    bootswatch = \"morph\"\n  ),\n  \n  \n  sidebar = sidebar(\n    title = \"Demo Controls\",\n    fillable = TRUE,\n    actionButton(\"randSeed\", \"Generate a new Graph\"),\n    accordion_filters <- accordion(\n      accordion_panel(\n        \"Intervention Effect and Observations\", \n        icon = bs_icon(\"card-checklist\"),\n      #Setup with input funcs in Shiny are always input id, then the name in the app\n      #followed by the values\n        numericInput(\"obs\", \"Number of Observations\", 100, min = 100),\n        sliderInput(\"inv_mmt\", \n                    \"Intervention Moment\", \n                    min = 4, \n                    max = 96, \n                    value = 70,\n                    animate = animationOptions(\n                      interval = 750,\n                      loop = TRUE\n                      )\n                    ),\n        sliderInput(\"inv_amt\", \n                    \"Intervention Amount\", \n                    50, \n                    100, \n                    50, \n                    animate = animationOptions(\n                      interval = 750,\n                      loop = TRUE\n                      )\n                    )\n      \n      )\n    )\n  ),\n  \n# Creates a Tab\n  tabsetPanel(\n    #   tabPanel(\n    #     title = \"Causal Impact Base Graph\",\n    #     card(\n    #       plotOutput(\"plot\")\n    #     ),\n    # \n    # ),\n\n      tabPanel(\n        title = \"Comparing Periods\",\n        card(\n          full_screen = TRUE,\n          plotOutput(\"plot2\")\n        )\n      )\n      # ),\n      # \n      # tabPanel(\n      #   title = \"Summary\",\n      #   card(\n      #     full_screen = TRUE,\n      #     verbatimTextOutput(\"summary\")\n      #   )\n      # )\n\n  ),\n\n  \n\n)\n\nserver <- function(input, output, session){\n#Sets the Plots to the same theme as a bslib theme :D\n  thematic_shiny()\n\n#Kind of like a list of values to set that can by dynamically allocated\n  v <- reactiveValues(\n    seed = 1,\n    data = 0,\n    x1 = 0,\n    y = 0,\n    lower_bound = 0,\n    pre.period = 0,\n    post.period = 0\n  )\n  \n#Tracks the Generate Button and updates the values accordingly\n  observeEvent(input$randSeed, {\n  #Create a random number generator:\n    v$seed <- sample.int(.Machine$integer.max, 1)\n    set.seed(v$seed)\n  })\n  \n#Tracks the Num of Observations and updates the values accordingly\n  observeEvent(input$obs, {\n    v$x1 <- input$obs + arima.sim(model = list(ar = 0.999), n = input$obs)\n    v$y <- 1.2 * v$x1 + rnorm(input$obs)\n  })\n  \n  \n#Tracks the Intervention Moment and updates the bounds accordingly\n  observeEvent(input$inv_mmt,{\n    v$lower_bound <- (input$inv_mmt[1] / 100) * input$obs\n    v$pre.period <- c(1,v$lower_bound)\n    v$post.period <- c(v$lower_bound+1,100)\n  })\n  \n#Tracks the Intervention Amount and updates the chosen interval accordingly\n  observeEvent(input$inv_amt,{\n    y <- v$y\n    y[71:100] <- y[71:100] + input$inv_amt\n    v$data <- cbind(y, v$x1)\n  })\n  # \n  # output$plot <- renderPlot({\n  # #Scaling the Bounds of the Intervention Effect\n  #   impact <- CausalImpact(v$data,v$pre.period, v$post.period)\n  #   the_plot <- plot(impact, \"pointwise\") +\n  #     geom_hline(yintercept = input$inv_amt,\n  #                col = 'red') +\n  #     plot(impact, c(\"original\", \"cumulative\"))\n  # \n  #   plot(the_plot)\n  # \n  # \n  # })\n\n  output$plot2 <- renderPlot ({\n    df <- data.frame(\n      time = 1:nrow(v$data),\n      y = v$data[, 1],\n      period = ifelse(1:nrow(v$data) <= v$lower_bound, \"1. Pre-intervention\",\"2. Post-intervention\")\n      \n    )\n    \n    \n    ggbetweenstats(\n      data = df,\n      x = period,\n      y = y,\n      title = \"Comparing the Pre and Post Intervention Periods\",\n      xlab = \"Period\",\n      ylab = \"Intervention Amounts\",\n      ggplot.component = list(theme(text = element_text(size = 17)))\n    )\n    \n    \n  })\n  # \n  # output$summary <- renderPrint ({\n  #   impact <- CausalImpact(v$data,v$pre.period, v$post.period)\n  #   summary(impact)\n  # })\n  # \n}\n\n\nshinyApp(ui,server)\n\n","type":"text"}]
